<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFIDC | Smart Store Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background: #f0f4f8; }
        
        /* Watermark Background */
        .watermark { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.08; z-index: -1; width: 300px; pointer-events: none; }

        /* Professional Form Design */
        .input-box { width: 100%; padding: 12px; border: 1.5px solid #cbd5e1; border-radius: 10px; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: #059669; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1); }

        /* SRN Book Style */
        .srn-paper { border: 2px solid #000; background: #fffde7; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 900px; margin: auto; position: relative; }
        .govt-table { width: 100%; border-collapse: collapse; border: 1.5px solid #000; margin-top: 10px; }
        .govt-table th, .govt-table td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 13px; }
        .govt-table th { background: #f1f5f9; font-weight: bold; }

        /* Blue Ledger Style */
        .ledger-blue-book { background-color: #a2d2ff; border: 2px solid #0056b3; padding: 20px; border-radius: 12px; overflow-x: auto; }
        .ledger-table { width: 100%; border-collapse: collapse; background: #fff; }
        .ledger-table th { border: 1px solid #0056b3; padding: 6px; font-size: 11px; background: #8ecae6; }
        .ledger-table td { border: 1px solid #0056b3; padding: 8px; font-size: 12px; text-align: center; }

        .btn-primary { background: #065f46; color: white; padding: 14px; border-radius: 10px; font-weight: bold; width: 100%; transition: 0.3s; cursor: pointer; }
        .btn-primary:hover { background: #064e3b; transform: translateY(-2px); }
        
        .nav-active { background: #065f46; color: white; }
        .red-alert { background: #fee2e2; color: #dc2626; font-weight: bold; padding: 2px 6px; border-radius: 5px; }
        
        /* --- PRINT LOGIC START --- */
        @media print {
            /* পুরো বডি থেকে সব কিছু হাইড করো */
            body * { visibility: hidden; background: none !important; box-shadow: none !important; }
            /* শুধুমাত্র যে SRN কার্ডটি প্রিন্ট হবে সেটি এবং তার ভেতরের সব কিছু দেখাও */
            .printable-area, .printable-area * { visibility: visible; }
            /* প্রিন্ট করার সময় কার্ডটি একদম উপরে নিয়ে আসো */
            .printable-area { position: absolute; left: 0; top: 0; width: 100%; border: 1px solid #000 !important; }
            .no-print { display: none !important; }
            .watermark { display: none; }
        }
        /* --- PRINT LOGIC END --- */
    </style>
</head>
<body class="pb-20">

    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/0/02/Bangladesh_Forest_Industries_Development_Corporation_logo.png/220px-Bangladesh_Forest_Industries_Development_Corporation_logo.png" class="watermark" alt="Logo">

    <header class="bg-[#1e293b] text-white p-5 sticky top-0 z-50 no-print flex justify-between items-center shadow-lg">
        <div>
            <h1 class="text-lg font-bold">বাংলাদেশ বনশিল্প উন্নয়ন কর্পোরেশন</h1>
            <p class="text-xs text-emerald-400 font-semibold tracking-wider">স্মার্ট স্টোর ম্যানেজমেন্ট</p>
        </div>
        <i class="fa-solid fa-layer-group text-2xl opacity-40"></i>
    </header>

    <main class="p-4 max-w-6xl mx-auto space-y-6">
        
        <div class="flex bg-white p-1 rounded-2xl shadow-md no-print overflow-x-auto gap-1">
            <button onclick="showPage('entry')" id="tab-entry" class="flex-1 py-3 text-sm font-bold nav-active rounded-xl transition">ডাটা এন্ট্রি</button>
            <button onclick="showPage('srn')" id="tab-srn" class="flex-1 py-3 text-sm font-bold transition rounded-xl">SRN বই</button>
            <button onclick="showPage('ledger')" id="tab-ledger" class="flex-1 py-3 text-sm font-bold transition rounded-xl">লেজার বুক</button>
            <button onclick="showPage('asset')" id="tab-asset" class="flex-1 py-3 text-sm font-bold transition rounded-xl">স্থায়ী সম্পদ</button>
        </div>

        <section id="entry-page" class="bg-white p-6 rounded-3xl shadow-xl space-y-5 no-print border-t-8 border-emerald-800">
            <h2 class="text-xl font-bold text-gray-700 border-b pb-3 uppercase">মালামাল গ্রহণ ফরম</h2>
            <input type="hidden" id="edit-id" value="">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="srn-no" placeholder="এস আর এন নং" class="input-box">
                <input type="date" id="srn-date" class="input-box">
            </div>

            <input type="text" id="from-vendor" placeholder="কোথা হতে প্রাপ্ত (শাখা বা ব্যক্তির নাম)" class="input-box uppercase">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <select id="reg-type" onchange="updateItemList()" class="input-box font-bold bg-emerald-50">
                    <option value="">রেজিস্টার নির্বাচন করুন</option>
                    <option value="1">১ নং রেজিস্টার</option>
                    <option value="2">২ নং রেজিস্টার</option>
                    <option value="3">৩ নং রেজিস্টার</option>
                </select>
                <select id="item-cat" class="input-box"></select>
            </div>

            <textarea id="item-detail" placeholder="মালামালের বিস্তারিত বিবরণ ও সাইজ..." class="input-box h-24"></textarea>
            
            <div class="grid grid-cols-3 gap-3">
                <input type="text" id="unit" placeholder="একক" class="input-box">
                <input type="number" id="qty" placeholder="পরিমাণ" class="input-box">
                <input type="number" id="price" placeholder="দর" class="input-box">
            </div>

            <button onclick="handleSave()" id="save-btn" class="btn-primary">তথ্য সংরক্ষণ করুন</button>
        </section>

        <section id="srn-page" class="hidden space-y-8"></section>

        <section id="ledger-page" class="hidden space-y-6">
            <div class="no-print bg-white p-4 rounded-2xl shadow-md">
                <input type="text" id="ledger-search" onkeyup="renderLedger()" placeholder="মালামালের নাম দিয়ে সার্চ..." class="input-box">
            </div>
            <div id="ledger-container"></div>
        </section>

        <section id="asset-page" class="hidden bg-white p-6 rounded-3xl border-2 border-black">
            <h2 class="text-center font-bold underline mb-6 text-xl uppercase">স্থায়ী সম্পদ রেজিস্টার</h2>
            <table class="govt-table">
                <thead>
                    <tr>
                        <th>ক্র: নং</th><th>সম্পদের বিবরণ</th><th>শাখা/স্থান</th><th>তারিখ</th><th class="no-print">অ্যাকশন</th>
                    </tr>
                </thead>
                <tbody id="asset-body"></tbody>
            </table>
        </section>
    </main>

    <script>
        const DB_KEY = 'BFIDC_FINAL_DB_V4';
        const categories = {
            "1": ["খুচরা যন্ত্রাংশ", "জেনারেটর মালামাল", "বোট/ইঞ্জিন মালামাল", "পাম্পের যন্ত্রাংশ", "জি আই ফিটিংস"],
            "2": ["ইলেকট্রিক মালামাল", "এস টি বি মালামাল", "গ্রাইডিং মালামাল", "টুলস মালামাল", "আয়রন এন্ড স্টিল মালামাল", "লিভারেজ মালামাল", "ওয়েল্ডিং মালামাল", "ওয়্যার রোপ এন্ড ফিটিংস", "মিতসুবিশি জীপ নং রাঙা ঘ ১১-০০৫১", "স' সুইজিং মেশিন", "স' ইকুলাইজিং মেশিন", "এসটিবি কেমিক্যাল মালামাল", "পি.ও.এল/লুব্রিকেন্ট মালামাল", "কম্পিউটার মালামাল"],
            "3": ["স্টেশনারী মালামাল", "নাট/বোল্ট", "টেস্ট হাউস সাপ্লাই মালামাল", "পাইপ এন্ড ফিটিংস মালামাল", "হিনো ট্রাক নং- রাঙামাটি-উ-০৫০০০৩", "টি-বোল্ট মালামাল", "স্পিনিং মালামাল", "জেনারেটর/ফটোকপি মেশিন", "মটর সাইকেল মালামাল"]
        };

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || [];

        function updateItemList() {
            const reg = document.getElementById('reg-type').value;
            const select = document.getElementById('item-cat');
            select.innerHTML = '<option value="">মালামালের প্রকার</option>';
            if(categories[reg]) {
                categories[reg].forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item;
                    opt.innerHTML = item;
                    select.appendChild(opt);
                });
            }
        }

        function handleSave() {
            const editId = document.getElementById('edit-id').value;
            const data = {
                id: editId ? parseInt(editId) : Date.now(),
                srn: document.getElementById('srn-no').value,
                date: document.getElementById('srn-date').value,
                vendor: document.getElementById('from-vendor').value,
                reg: document.getElementById('reg-type').value,
                cat: document.getElementById('item-cat').value,
                detail: document.getElementById('item-detail').value,
                unit: document.getElementById('unit').value,
                qty: parseFloat(document.getElementById('qty').value) || 0,
                price: parseFloat(document.getElementById('price').value) || 0
            };

            if(!data.srn || !data.cat) return alert("তথ্য অসম্পূর্ণ!");

            if(editId) {
                const idx = db.findIndex(x => x.id === data.id);
                db[idx] = data;
                alert("আপডেট হয়েছে!");
            } else {
                db.push(data);
                alert("সেভ হয়েছে!");
            }

            localStorage.setItem(DB_KEY, JSON.stringify(db));
            location.reload();
        }

        function printSpecific(elementId) {
            // কার্ডটিতে একটি টেম্পোরারি ক্লাস দাও যেটা প্রিন্ট CSS চেনে
            const cards = document.querySelectorAll('.srn-paper');
            cards.forEach(c => c.classList.remove('printable-area'));
            
            const cardToPrint = document.getElementById(elementId);
            cardToPrint.classList.add('printable-area');
            
            window.print();
        }

        function renderSRN() {
            const container = document.getElementById('srn-page');
            container.innerHTML = db.slice().reverse().map(d => `
                <div id="card-${d.id}" class="srn-paper">
                    <div class="no-print flex justify-end gap-2 mb-4">
                        <button onclick="editData(${d.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-xs">এডিট</button>
                        
