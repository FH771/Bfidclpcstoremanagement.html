<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFIDCLPC ERP | Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background: #f8fafc; }
        .glass-card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .sidebar { transition: 0.3s; transform: translateX(100%); }
        .sidebar.active { transform: translateX(0); }
        .folder-card { background: #fff; border: 1px solid #e2e8f0; transition: 0.2s; cursor: pointer; }
        .folder-card:hover { border-color: #10b981; background: #f0fdf4; }
        th { background: #0f172a; color: white; padding: 10px; font-size: 11px; }
        td { border: 1px solid #e2e8f0; padding: 8px; font-size: 12px; text-align: center; }
        .nav-active { color: #10b981 !important; border-top: 3px solid #10b981; }
    </style>
</head>
<body class="pb-24 overflow-x-hidden">

    <div id="loginScreen" class="fixed inset-0 bg-[#004d40] z-[9999] flex items-center justify-center">
        <div class="bg-white p-10 rounded-3xl w-full max-w-sm text-center shadow-2xl mx-4">
            <h2 class="text-xl font-bold text-gray-800">বাংলাদেশ বনশিল্প উন্নয়ন কর্পোরেশন</h2>
            <p class="text-emerald-600 font-bold mb-6 tracking-widest uppercase">ম্যানেজমেন্ট</p>
            <input type="password" id="passInput" placeholder="পাসওয়ার্ড দিন" class="w-full p-4 bg-gray-100 rounded-xl text-center text-2xl mb-4 outline-none border-2 border-transparent focus:border-emerald-500">
            <button onclick="checkPass()" class="w-full bg-[#004d40] text-white py-4 rounded-xl font-bold uppercase tracking-widest">আনলক করুন</button>
        </div>
    </div>

    <div id="appBody" class="hidden">
        <header class="bg-[#004d40] text-white p-5 sticky top-0 z-40 flex justify-between items-center shadow-md">
            <div class="text-left">
                <h1 class="text-base font-bold leading-tight">বাংলাদেশ বনশিল্প উন্নয়ন কর্পোরেশন</h1>
                <p class="text-[11px] font-semibold text-emerald-300 tracking-[3px] uppercase">ম্যানেজমেন্ট</p>
            </div>
            <button onclick="toggleSidebar()" class="text-2xl"><i class="fa-solid fa-bars-staggered"></i></button>
        </header>

        <div id="sidebar" class="sidebar fixed top-0 right-0 h-full w-64 bg-white z-[50] shadow-2xl p-6">
            <div class="flex justify-between items-center mb-10">
                <h3 class="font-bold text-gray-800">সেটিংস</h3>
                <button onclick="toggleSidebar()" class="text-red-500"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="text-xs font-bold text-gray-400 block mb-2 uppercase">পাসওয়ার্ড পরিবর্তন করুন</label>
                    <input type="password" id="newPass" placeholder="নতুন পাসওয়ার্ড" class="w-full p-3 bg-gray-100 rounded-lg mb-2 text-sm outline-none">
                    <button onclick="updatePassword()" class="w-full bg-emerald-600 text-white py-2 rounded-lg text-sm font-bold">আপডেট করুন</button>
                </div>
                <button onclick="clearAllData()" class="w-full text-left text-red-500 text-sm font-bold pt-10 border-t"><i class="fa-solid fa-trash-can mr-2"></i>সব ডাটা মুছুন</button>
            </div>
        </div>

        <main class="p-4 max-w-4xl mx-auto">
            <section id="tab-in" class="tab-content">
                <div class="glass-card p-6 mb-6">
                    <h2 class="font-bold text-[#004d40] mb-4 border-b pb-2"><i class="fa-solid fa-cart-plus mr-2"></i>মালামাল গ্রহণ এন্ট্রি</h2>
                    <div class="space-y-4">
                        <input type="hidden" id="editId">
                        <div class="flex gap-2">
                            <input type="text" id="srnNo" placeholder="SRN নং" class="w-1/3 p-3 bg-gray-50 border rounded-xl outline-none">
                            <input type="date" id="entryDate" class="w-2/3 p-3 bg-gray-50 border rounded-xl outline-none">
                        </div>
                        <select id="regSelect" onchange="loadCategoryDropdown()" class="w-full p-4 bg-gray-50 border rounded-xl font-bold text-emerald-800 outline-none">
                            <option value="">রেজিস্টার সিলেক্ট করুন</option>
                            <option value="1">১ নং রেজিস্টার (খুচরা যন্ত্রাংশ)</option>
                            <option value="2">২ নং রেজিস্টার (ইলেকট্রিক ও হার্ডওয়্যার)</option>
                            <option value="3">৩ নং রেজিস্টার (অন্যান্য মালামাল)</option>
                        </select>
                        <select id="catSelect" class="w-full p-4 bg-white border rounded-xl outline-none"></select>
                        <input type="text" id="itemDetail" placeholder="মালামালের বিস্তারিত নাম" class="w-full p-4 border-2 border-emerald-50 rounded-xl focus:border-emerald-500 outline-none">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" id="itemQty" placeholder="পরিমাণ" class="p-4 bg-gray-50 border rounded-xl">
                            <input type="number" id="itemPrice" placeholder="দর (৳)" class="p-4 bg-gray-50 border rounded-xl">
                        </div>
                        <button id="saveBtn" onclick="saveStock()" class="w-full bg-[#004d40] text-white py-4 rounded-xl font-bold shadow-lg">সেভ করুন</button>
                        <button id="cancelBtn" onclick="resetForm()" class="hidden w-full bg-gray-400 text-white py-2 rounded-xl font-bold">বাতিল করুন</button>
                    </div>
                </div>
            </section>

            <section id="tab-ledger" class="tab-content hidden">
                <div id="folderList" class="grid grid-cols-2 gap-4"></div>
                <div id="folderDetailView" class="hidden space-y-4">
                    <button onclick="closeFolder()" class="text-emerald-700 font-bold mb-2"><i class="fa-solid fa-arrow-left mr-2"></i>ফোল্ডারে ফিরে যান</button>
                    <div class="glass-card overflow-hidden">
                        <div class="bg-emerald-50 p-4 border-b">
                            <h3 id="selectedFolderName" class="font-bold text-emerald-900 uppercase"></h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr>
                                        <th>তারিখ</th>
                                        <th>বিবরণ</th>
                                        <th>পরিমাণ</th>
                                        <th>মোট</th>
                                        <th>অ্যাকশন</th>
                                    </tr>
                                </thead>
                                <tbody id="lagerTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 z-40 shadow-2xl">
            <button onclick="showTab('in')" id="nav-in" class="flex-1 py-1 nav-active text-gray-400"><i class="fa-solid fa-plus-circle text-xl mb-1"></i><br><span class="text-[10px] font-bold">এন্ট্রি</span></button>
            <button onclick="showTab('ledger')" id="nav-ledger" class="flex-1 py-1 text-gray-400"><i class="fa-solid fa-folder-open text-xl mb-1"></i><br><span class="text-[10px] font-bold">খতিয়ান</span></button>
        </nav>
    </div>

    <script>
        const categoryMap = {
            "1": ["ইঞ্জিন পার্টস", "বিয়ারিং", "পাম্প পার্টস", "খুচরা যন্ত্রাংশ"],
            "2": ["ইলেকট্রিক মালামাল", "হার্ডওয়্যার", "নাট-বোল্ট", "জি আই পাইপ"],
            "3": ["স্টেশনারী", "টায়ার ও টিউব", "লুব্রিকেন্ট", "অন্যান্য"]
        };

        let db = JSON.parse(localStorage.getItem('bfidclpc_v10')) || { pass: "1234", entries: [] };

        function checkPass() {
            if(document.getElementById('passInput').value === db.pass) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appBody').classList.remove('hidden');
            } else { alert("ভুল পাসওয়ার্ড!"); }
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        function updatePassword() {
            const newP = document.getElementById('newPass').value;
            if(newP.length < 4) return alert("পাসওয়ার্ড কমপক্ষে ৪ অক্ষরের হতে হবে!");
            db.pass = newP;
            save(); alert("পাসওয়ার্ড আপডেট হয়েছে!"); toggleSidebar();
        }

        function loadCategoryDropdown(selectedCat = "") {
            const reg = document.getElementById('regSelect').value;
            const catSelect = document.getElementById('catSelect');
            catSelect.innerHTML = '<option value="">মালামালের ধরন সিলেক্ট করুন</option>';
            if(reg) {
                categoryMap[reg].forEach(c => {
                    catSelect.innerHTML += `<option value="${c}" ${c === selectedCat ? 'selected' : ''}>${c}</option>`;
                });
            }
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('nav-' + id).classList.add('nav-active');
            if(id === 'ledger') renderFolders();
        }

        function saveStock() {
            const editId = document.getElementById('editId').value;
            const entry = {
                date: document.getElementById('entryDate').value,
                srn: document.getElementById('srnNo').value,
                reg: document.getElementById('regSelect').value,
                category: document.getElementById('catSelect').value,
                detail: document.getElementById('itemDetail').value.trim(),
                qty: parseFloat(document.getElementById('itemQty').value) || 0,
                price: parseFloat(document.getElementById('itemPrice').value) || 0,
                id: editId ? parseInt(editId) : Date.now()
            };

            if(!entry.category || !entry.detail || entry.qty <= 0) return alert("তথ্য পূরণ করুন!");

            if(editId) {
                const index = db.entries.findIndex(e => e.id === entry.id);
                db.entries[index] = entry;
                alert("এডিট সফল হয়েছে!");
            } else {
                db.entries.push(entry);
                alert("সেভ করা হয়েছে!");
            }

            save(); resetForm(); showTab('ledger');
        }

        function editEntry(id) {
            const entry = db.entries.find(e => e.id === id);
            document.getElementById('editId').value = entry.id;
            document.getElementById('entryDate').value = entry.date;
            document.getElementById('srnNo').value = entry.srn;
            document.getElementById('regSelect').value = entry.reg;
            loadCategoryDropdown(entry.category);
            document.getElementById('itemDetail').value = entry.detail;
            document.getElementById('itemQty').value = entry.qty;
            document.getElementById('itemPrice').value = entry.price;
            
            document.getElementById('saveBtn').innerText = "আপডেট করুন";
            document.getElementById('cancelBtn').classList.remove('hidden');
            showTab('in');
        }

        function deleteEntry(id) {
            if(confirm("আপনি কি নিশ্চিতভাবে এই এন্ট্রিটি মুছতে চান?")) {
                db.entries = db.entries.filter(e => e.id !== id);
                save(); 
                const openCat = document.getElementById('selectedFolderName').innerText;
                openCat ? openFolder(openCat) : renderFolders();
            }
        }

        function resetForm() {
            document.getElementById('editId').value = "";
            document.getElementById('saveBtn').innerText = "সেভ করুন";
            document.getElementById('cancelBtn').classList.add('hidden');
            document.getElementById('itemDetail').value = "";
            document.getElementById('itemQty').value = "";
            document.getElementById('itemPrice').value = "";
        }

        function renderFolders() {
            const list = document.getElementById('folderList');
            document.getElementById('folderDetailView').classList.add('hidden');
            list.classList.remove('hidden');
            const uniqueCats = [...new Set(db.entries.map(e => e.category))];
            list.innerHTML = uniqueCats.map(cat => `
                <div onclick="openFolder('${cat}')" class="folder-card p-5 rounded-2xl text-center shadow-sm">
                    <i class="fa-solid fa-folder text-amber-400 text-4xl mb-2"></i>
                    <h4 class="font-bold text-gray-700 text-sm uppercase">${cat}</h4>
                    <p class="text-[10px] text-gray-400 font-bold">${db.entries.filter(e => e.category === cat).length} এন্ট্রি</p>
                </div>
            `).join('');
        }

        function openFolder(cat) {
            document.getElementById('folderList').classList.add('hidden');
            document.getElementById('folderDetailView').classList.remove('hidden');
            document.getElementById('selectedFolderName').innerText = cat;
            const filtered = db.entries.filter(e => e.category === cat);
            document.getElementById('lagerTableBody').innerHTML = filtered.map(e => `
                <tr>
                    <td>${e.date}<br><small>SRN:${e.srn}</small></td>
                    <td class="text-left font-bold">${e.detail}</td>
                    <td>${e.qty}</td>
                    <td>৳${(e.qty * e.price).toLocaleString()}</td>
                    <td class="flex gap-2 justify-center">
                        <button onclick="editEntry(${e.id})" class="text-blue-500 p-1"><i class="fa-solid fa-pen-to-square"></i></button>
                        <button onclick="deleteEntry(${e.id})" class="text-red-500 p-1"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `).reverse().join('');
        }

        function closeFolder() {
            document.getElementById('folderDetailView').classList.add('hidden');
            document.getElementById('folderList').classList.remove('hidden');
            document.getElementById('selectedFolderName').innerText = "";
        }

        function save() { localStorage.setItem('bfidclpc_v10', JSON.stringify(db)); }
        function clearAllData() { if(confirm("সব ডাটা মুছে যাবে!")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
