<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFIDCLPC | Professional Store ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Hind+Siliguri:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', 'Hind Siliguri', sans-serif; background: #0f172a; color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; }
        .active-nav { background: #10b981 !important; color: #022c22 !important; box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        input, select, textarea { background: rgba(255, 255, 255, 0.05) !important; border: 1px solid rgba(255, 255, 255, 0.1) !important; color: white !important; outline: none; }
        .btn-primary { background: #10b981; color: #022c22; font-weight: 800; }
        .btn-danger { background: #ef4444; color: white; font-weight: 800; }
        .text-accent { color: #10b981; }
    </style>
</head>
<body class="pb-32">
    <div id="loginScreen" class="fixed inset-0 bg-[#022c22] z-[9999] flex items-center justify-center">
        <div class="glass p-10 w-full max-w-sm text-center">
            <h2 class="text-3xl font-black mb-6 uppercase tracking-widest text-white">BFIDCLPC</h2>
            <input type="password" id="passInput" placeholder="Enter Password" class="w-full p-4 rounded-xl text-center text-2xl mb-4 tracking-[10px]">
            <button onclick="checkPass()" class="w-full btn-primary py-4 rounded-xl font-bold uppercase tracking-widest">Unlock System</button>
        </div>
    </div>

    <div id="appBody" class="hidden">
        <header class="p-8 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black text-accent">BFIDCLPC <span class="text-white">ERP</span></h1>
                <p class="text-[10px] uppercase tracking-widest text-slate-400">Smart Store Management</p>
            </div>
            <button onclick="manualLock()" class="glass w-10 h-10 flex items-center justify-center text-red-400"><i class="fa-solid fa-power-off"></i></button>
        </header>

        <main class="px-6 space-y-6 max-w-4xl mx-auto">
            <section id="tab-folders" class="tab-content space-y-4">
                <div class="glass p-6">
                    <h3 class="font-bold text-accent uppercase text-xs tracking-widest mb-4"><i class="fa-solid fa-folder-plus mr-2"></i>New Folder</h3>
                    <div class="flex gap-2">
                        <input type="text" id="newFolderInput" placeholder="Folder Name..." class="flex-1 p-3 rounded-xl text-sm">
                        <button onclick="addFolder()" class="btn-primary px-6 py-3 rounded-xl"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
                <div id="folderGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
            </section>

            <section id="tab-in" class="tab-content hidden glass p-6 space-y-4">
                <h3 class="font-bold text-accent uppercase text-xs tracking-widest">Stock Entry</h3>
                <select id="folderSelect" class="w-full p-4 rounded-xl font-bold text-sm"></select>
                <input type="text" id="itemModel" placeholder="Item Name/Model" class="w-full p-4 rounded-xl font-bold">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="itemPrice" placeholder="Unit Price (৳)" class="w-full p-4 rounded-xl">
                    <input type="number" id="itemQty" placeholder="Quantity" class="w-full p-4 rounded-xl">
                </div>
                <input type="text" id="itemSupplier" placeholder="Supplier Name" class="w-full p-4 rounded-xl">
                <button onclick="saveStock()" class="w-full btn-primary py-4 rounded-xl font-black uppercase">Save to Stock</button>
            </section>

            <section id="tab-out" class="tab-content hidden glass p-6 space-y-4">
                <h3 class="font-bold text-red-400 uppercase text-xs tracking-widest">Issue Resource</h3>
                <select id="issueItemSelect" class="w-full p-4 rounded-xl text-sm font-bold"></select>
                <input type="number" id="issueQty" placeholder="Issue Quantity" class="w-full p-4 rounded-xl">
                <select id="issueUnit" class="w-full p-4 rounded-xl text-sm">
                    <option>SAW MILL UNIT</option><option>PLANER MILL</option><option>WORKSHOP</option>
                </select>
                <textarea id="issueNotes" placeholder="Notes..." class="w-full p-4 rounded-xl" rows="2"></textarea>
                <button onclick="confirmIssue()" class="w-full btn-danger py-4 rounded-xl font-black uppercase">Confirm Issue</button>
            </section>

            <section id="tab-ledger" class="tab-content hidden space-y-4">
                <div class="glass overflow-hidden">
                    <table class="w-full text-[11px]">
                        <thead class="bg-white/5 text-slate-400 uppercase">
                            <tr><th class="p-4 text-left">Item</th><th class="p-4 text-center">Qty</th><th class="p-4 text-right">Value</th><th class="p-4 text-center">Action</th></tr>
                        </thead>
                        <tbody id="ledgerTable" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </section>

            <section id="tab-history" class="tab-content hidden space-y-4">
                <div class="glass overflow-hidden">
                    <table class="w-full text-[11px]">
                        <thead class="bg-white/5 text-slate-400 uppercase">
                            <tr><th class="p-4 text-left">Date</th><th class="p-4 text-left">Type</th><th class="p-4 text-left">Item</th><th class="p-4 text-center">Qty</th><th class="p-4 text-left">Unit</th></tr>
                        </thead>
                        <tbody id="historyTable" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-6 left-6 right-6 flex glass p-2 justify-between z-[999]">
            <button onclick="showTab('folders')" id="btn-folders" class="flex-1 py-4 rounded-2xl active-nav"><i class="fa-solid fa-folder-open"></i></button>
            <button onclick="showTab('in')" id="btn-in" class="flex-1 py-4 rounded-2xl"><i class="fa-solid fa-plus-circle"></i></button>
            <button onclick="showTab('out')" id="btn-out" class="flex-1 py-4 rounded-2xl"><i class="fa-solid fa-paper-plane"></i></button>
            <button onclick="showTab('ledger')" id="btn-ledger" class="flex-1 py-4 rounded-2xl"><i class="fa-solid fa-list-check"></i></button>
            <button onclick="showTab('history')" id="btn-history" class="flex-1 py-4 rounded-2xl"><i class="fa-solid fa-history"></i></button>
        </nav>
    </div>

    <script>
        const AUTH = "1234";
        let db = JSON.parse(localStorage.getItem('bfidclpc_v4')) || { folders: ["BEARING", "TIMBER"], items: [], transactions: [] };

        window.onload = () => { if(sessionStorage.getItem('logged') === 'yes') unlock(); };
        function checkPass() { if(document.getElementById('passInput').value === AUTH) { sessionStorage.setItem('logged', 'yes'); unlock(); } else alert("Wrong Password!"); }
        function unlock() { document.getElementById('loginScreen').classList.add('hidden'); document.getElementById('appBody').classList.remove('hidden'); renderFolders(); }
        function manualLock() { sessionStorage.removeItem('logged'); location.reload(); }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-nav'));
            document.getElementById('btn-' + id).classList.add('active-nav');
            if(id === 'folders') renderFolders();
            if(id === 'in') syncSelects();
            if(id === 'ledger') renderLedger();
            if(id === 'out') syncIssueList();
            if(id === 'history') renderHistory();
        }

        function addFolder() {
            const name = document.getElementById('newFolderInput').value.toUpperCase().trim();
            if(name && !db.folders.includes(name)) { db.folders.push(name); save(); renderFolders(); document.getElementById('newFolderInput').value=''; }
        }

        function renderFolders() {
            const grid = document.getElementById('folderGrid');
            grid.innerHTML = db.folders.map(f => `
                <div class="glass p-5 relative">
                    <i class="fa-solid fa-folder text-accent text-2xl mb-2"></i>
                    <h4 class="font-black text-xs uppercase">${f}</h4>
                    <p class="text-[9px] text-slate-500">${db.items.filter(i => i.folder === f).length} ITEMS</p>
                </div>
            `).join('');
        }

        function syncSelects() { document.getElementById('folderSelect').innerHTML = db.folders.map(f => `<option>${f}</option>`).join(''); }

        function syncIssueList() { document.getElementById('issueItemSelect').innerHTML = db.items.map(i => `<option value="${i.id}">${i.folder} | ${i.model} (${i.qty})</option>`).join(''); }

        function saveStock() {
            const folder = document.getElementById('folderSelect').value;
            const model = document.getElementById('itemModel').value.toUpperCase().trim();
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const qty = parseFloat(document.getElementById('itemQty').value) || 0;
            if(!model) return alert("Enter Name!");

            let item = db.items.find(i => i.model === model && i.folder === folder);
            if(item) { item.qty += qty; item.price = price; } 
            else { db.items.push({ id: Date.now(), folder, model, price, qty }); }

            db.transactions.push({ date: new Date().toISOString(), type: 'IN', model, qty, unit: 'STORE', folder });
            save(); alert("Saved!"); showTab('ledger');
        }

        function confirmIssue() {
            const id = document.getElementById('issueItemSelect').value;
            const qty = parseFloat(document.getElementById('issueQty').value) || 0;
            const unit = document.getElementById('issueUnit').value;
            const item = db.items.find(i => i.id == id);
            if(item && item.qty >= qty) {
                item.qty -= qty;
                db.transactions.push({ date: new Date().toISOString(), type: 'OUT', model: item.model, qty, unit, folder: item.folder });
                save(); alert("Issued!"); showTab('ledger');
            } else alert("Insufficient Stock!");
        }

        function renderLedger() {
            document.getElementById('ledgerTable').innerHTML = db.items.map(i => `
                <tr class="border-b border-white/5 text-[10px]">
                    <td class="p-4"><b>${i.model}</b><br><span class="text-accent">${i.folder}</span></td>
                    <td class="p-4 text-center">${i.qty}</td>
                    <td class="p-4 text-right">৳${(i.qty * i.price).toLocaleString()}</td>
                    <td class="p-4 text-center"><button onclick="deleteItem(${i.id})" class="text-red-400"><i class="fa-solid fa-trash"></i></button></td>
                </tr>
            `).join('');
        }

        function deleteItem(id) { if(confirm("Delete item?")) { db.items = db.items.filter(i => i.id != id); save(); renderLedger(); } }

        function renderHistory() {
            document.getElementById('historyTable').innerHTML = db.transactions.slice().reverse().map(t => `
                <tr class="border-b border-white/5">
                    <td class="p-4 text-slate-500">${new Date(t.date).toLocaleDateString()}</td>
                    <td class="p-4 ${t.type === 'IN' ? 'text-accent' : 'text-red-400'} font-bold">${t.type}</td>
                    <td class="p-4">${t.model}</td>
                    <td class="p-4 text-center">${t.qty}</td>
                    <td class="p-4">${t.unit}</td>
                </tr>
            `).join('');
        }

        function save() { localStorage.setItem('bfidclpc_v4', JSON.stringify(db)); }
    </script>
</body>
</html>
